<!-- templates/csv_xlsx_upload_display.html -->
{% extends 'base.html' %}

{% load custom_tags %}

{% block body %}

<h2>Importar e visualizar arquivo CSV/XLSX</h2>
<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="file" required>
    <button type="submit">Importar</button>
</form>

{% if table_data and columns %}
    <h2>Tabela importada</h2>

    <form method="POST" action="{% url 'remove_duplicates' %}">
        {% csrf_token %}
        <input type="hidden" name="table_data" value="{{ table_data|jsonify }}">
        <input type="hidden" name="columns" value="{{ columns|jsonify }}">

        <label for="remove_duplicates">Remover duplicados</label>
        <input type="checkbox" name="remove_duplicates" id="remove_duplicates">
        <br>
        <label for="replace_duplicates">Trocar duplicados por campo vazio</label>
        <input type="checkbox" name="replace_duplicates" id="replace_duplicates">
        <br>
        <label for="remove_column">Remover coluna</label>
        <input type="checkbox" name="remove_column" id="remove_column">
        <br>

        <table border="1">
            <thead>
                <tr>
                    {% for column in columns %}
                    <th>
                        <label for="{{ column }}">{{ column }}</label>
                        <input type="checkbox" name="selected_columns" value="{{ column }}" id="{{ column }}">
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_data %}
                <tr>
                    {% for column in columns %}
                    <td>{{ row|get:column }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button type="submit">Aplicar ações</button>
    </form>

    <form method="POST" action="{% url 'save_changes' %}">
        {% csrf_token %}
        <input type="hidden" name="table_data" value="{{ table_data|jsonify }}">
        <input type="hidden" name="columns" value="{{ columns|jsonify }}">
        
        <label for="filename">Nome do arquivo para salvar:</label>
        <input type="text" name="filename" id="filename" value="{{ original_filename }}" required>
        <label for="file_type">Tipo de arquivo:</label>
        <select name="file_type" id="file_type">
            <option value="csv">CSV</option>
            <option value="xlsx">XLSX</option>
        </select>
        
        <button type="submit">Salvar alterações</button>
    </form>

{% endif %}

{% endblock body %}